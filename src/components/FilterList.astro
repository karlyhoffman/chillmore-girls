---
import Card from '../components/Card.astro';
import styles from '../styles/components/filter-list.module.scss';

const { items = [], filterValues = [], filterProperty = '' } = Astro.props;
---

{items.length && (
  <filter-list
    data-filters={JSON.stringify(filterValues)}
    data-filter-property={filterProperty}
  >
    <div class={styles['filter-list']}>

      <div class={styles['filter-list__filters']}>
        <button aria-selected="true" aria-disabled="true" disabled>All</button>
        <button>Pre-rolled</button>
        <button>Flower</button>
        <button>Edibles</button>
      </div>

      <ul class={styles['filter-list__results']} role="list">
        {items.map(({ title = '', slug, type = '', rating }) => {
          if (!title?.length || !slug?.length) return null;
          
          return (
            <li data-type={type}>
              <Card
                href={slug}
                title={title}
                rating={rating}
              />
            </li>
          )
        })}
      </ul>
    </div>
  </filter-list>
)}

<script>
  class FilterList extends HTMLElement {
    filters: any[];

    constructor() {
      super();
      // "In the class constructor, you can set up initial state 
      // and default values, register event listeners and perhaps 
      // create a shadow root. 
      // At this point, YOU SHOULD NOT inspect the element's attributes or children, 
      // or add new attributes or children." --MDN Web Docs

      // const element = this;
      const { filters = '[]' } = this.dataset;
      this.filters = JSON.parse(filters);
    }

    connectedCallback() {
      // "Called every time the element is inserted into the DOM. 
      // Useful for running setup code, such as fetching resources 
      // or rendering. Generally, you should try to delay work until 
      // this time." --MDN Web Docs

      this.renderFilterButtons();
    }

    renderFilterButtons() {
      // const { results } = this;

      console.log(this.filters);

      // const filters = this.results.reduce((acc, result) => {

      //   console.log(result);

      //   const { Type: type } = result;
      //   if (type?.select?.name && !acc.includes(type.select.name)) acc.push(type.select.name);

      //   return acc;
      // }, []);

      // console.log({filters});

      // const filterButtons = filters.map((filter) => {
      //   const button = document.createElement('button');
      //   button.textContent = filter;
      //   button.addEventListener('click', () => {
      //     this.filterResults(filter);
      //   });
      //   return button;
      // });

      // const container = document.createElement('div');
      // container.append(...filterButtons);
      // this.append(container);
    }
  }

  customElements.define('filter-list', FilterList);
</script>